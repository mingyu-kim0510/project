<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
    <div id="map" style="width:100%;height:350px;"></div>
    <hr>
    <input type="text" id="searchVal" />
    <button id="fetchBtn" type="button" class="btn btn-primary" >button test</button>
</div>
<hr>
<div class="container">
    <table class="table">
        <thead>
        <tr>
            <td style="width:10%">번호</td>
            <td style="width:30%">가게이름</td>
            <td style="width:30%">가게주소</td>
            <td style="width:30%">사이트 정보</td>
        </tr>
        </thead>
        <tbody id="innerList">

        </tbody>
    </table>
</div>
</body>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=452c7ddc8ed8a9dd0f1f2a182fe1303f"></script>
<script>
    const fetchBtn = document.getElementById('fetchBtn');
    const searchVal = document.getElementById('searchVal');
    fetchBtn.addEventListener('click', async () => {
        // request
        const response = await fetch('/api/store/list', {
            method:'post',
            headers: {
                'Content-Type':'application/json'
            },
            body: JSON.stringify({
                searchVal : searchVal.value
            })
        });
        const result = await response.json();

        // 지도결과 출력
        var positions = [
        ];
        let latMean = 0;
        let lngMean = 0;
        result.forEach(item => {
            console.log(item.storeLon)
            console.log(item.storeLat)
            positions.push({
                title: item.post_SJ,
                latlng: new kakao.maps.LatLng(parseFloat(item.storeLon), parseFloat(item.storeLat))
            })
            latMean += parseFloat(item.storeLon);
            lngMean += parseFloat(item.storeLat);
        })
        latMean = latMean / positions.length;
        lngMean = lngMean / positions.length;


        var mapOption = {
            center: new kakao.maps.LatLng(latMean, lngMean), // 지도의 중심좌표
            level: 7 // 지도의 확대 레벨
        };
        var mapContainer = document.getElementById('map') // 지도를 표시할 div

        var map = '';
        map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
            // 마커를 표시할 위치와 title 객체 배열입니다



        // 마커 이미지의 이미지 주소입니다
        var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

        for (var i = 0; i < positions.length; i ++) {

            // 마커 이미지의 이미지 크기 입니다
            var imageSize = new kakao.maps.Size(24, 35);

            // 마커 이미지를 생성합니다
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                map: map, // 마커를 표시할 지도
                position: positions[i].latlng, // 마커를 표시할 위치
                title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                image : markerImage // 마커 이미지
            });
        }

        // 검색결과 출력
        const storeList = document.getElementById('innerList');
        storeList.innerHTML = ''
        result.forEach(item => {
            storeList.innerHTML += `
            <tr>
                <td>${item.storeIdx}</td>
                <td>${item.storeName}</td>
                <td>${item.storeNewAddr}</td>
                <td>${item.storeUrl}</td>
            </tr>
            `
        })
    });
</script>
</html>