<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Likelist</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
            crossorigin="anonymous"
    />
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
            crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square.css" />
    <style>
        body {
            font-family: 'NanumSquareExtraBold';
        }
        /* 스크롤 가능한 컨테이너 스타일 */
        .scrollable-container {
            max-height: 680px; /* 원하는 높이로 설정 */
            overflow: auto;
            border: 0px;
            padding: 10px; /* 내용과 테두리 간의 간격 (선택 사항) */
        }
    </style>
</head>
<body>

<!-- Modal -->
<div class="modal" id="myModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="height:calc(100% + 3.5rem)">
            <div class="modal-body">
                <iframe id="framesrc" src=""
                        style="height:80vh; width:100%"
                ></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-close" onclick="document.getElementById('myModal').style.display ='none'; document.getElementById('framesrc').src = ''"></button>
            </div>
        </div>
    </div>
</div>

<h2 style="font-size: 2rem; transform: rotate(0.04deg)" class="col mb-5 mt-5 fw-bold text-center">찜 목록</h2>
<input
        class="form-check-input"
        style="margin-left: 10px; margin-right: 10px; transform: rotate(0.04deg)"
        type="checkbox"
        value=""
        id="flexCheckDefault"
/>
<label class="form-check-label fw-bold" id="checker" for="flexCheckDefault" style="transform: rotate(0.04deg)"> 여유만 표시 </label>
<div class="scrollable-container mt-2" id="cardInnerHTML"
     style="transform: rotate(0.04deg)">
    <!--
찜 리스트 내용
-->
</div>

<div id="menuBar"></div>
<script src="/js/menuBar.js"></script>

</body>

<script>
    const cardInnerHTML = document.getElementById('cardInnerHTML');
    const flexCheckDefault = document.getElementById('flexCheckDefault');
    console.log(flexCheckDefault.checked)
    flexCheckDefault.addEventListener('click', async () => {
        const resp = await fetch('/getLikeAll', { method: 'post' });
        const result = await resp.json();
        console.log(result);
        tempData = result;
        if (flexCheckDefault.checked) {
            render(result, true);
        } else {
            render(result, false);

        }
    })
    var tempData = [];
    sendData();
    async function sendData() {
        const resp = await fetch('/getLikeAll', { method: 'post' });
        const result = await resp.json();
        console.log(result);
        tempData = result;

        render(result);
    }
    function render(result, isChecked) {
        cardInnerHTML.innerHTML = '';
        result.forEach((item) => {
            if (!isChecked || item.distDensity == '여유') {

                let isTempUrl;
                if(item.storeUrl) isTempUrl = true;
                else isTempUrl = false;
                cardInnerHTML.innerHTML += `
                <div class="card mb-4" style="transform: rotate(0.04deg)">
                    <div class="card-header">
                        <span>
                            <div class="row fw-bold">
                                <div class="col-7">
                                    <a style="font-size: 0.9rem; margin-left: 0.4rem" onclick=" if(${isTempUrl}) {document.getElementById('framesrc').src='${item.storeUrl}'; document.querySelector('#myModal').style.display = 'block'}">${item.storeName}</a>
                                </div>
                                ${colorinnerHTML(item.distDensity)}
                                <div class="col-1">
                                    <a id="like-button" data-name="${item.storeName}" data-store="${item.storeNewAddr}" onclick="undo(this);">
                                        <img src="/img/star-fill.svg" alt="star">
                                    </a>
                                </div>
                            </div>
                        </span>
                    </div>
                </div>
                `;
            }
        });
    }
    // 버튼 클릭 시 부모 div 삭제하는 함수
    function removeCard() {
        var card = this.closest('.card');
        card.remove();
    }

    // 모든 like-button 요소에 클릭 이벤트 추가
    var likeButtons = document.querySelectorAll('#like-button');
    likeButtons.forEach(function (button) {
        button.addEventListener('click', removeCard);
    });

    async function undo(element) {
        const storeName = element.dataset.name;
        const storeNewAddr = element.dataset.store;
        console.log(storeName, storeNewAddr);
        await fetch('/like', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                storeName: storeName,
                storeNewAddr: storeNewAddr,
            }),
        });
        const itemFind = tempData.find((item) => {
            return item.storeName === storeName;
        });
        const idx = tempData.indexOf(itemFind);
        if (idx > -1) {
            tempData.splice(idx, 1);
        }
        render(tempData);
    }

    function colorinnerHTML (element) {
        if (element == '혼잡') {
            return `
            <div
                class="col-3"
                style="background-color: #fc5230; color:white; line-height: 1.6rem; border-radius: 4px"
            >
                <a style="font-size: 0.9rem; transform: rotate(0.04deg)">${element}</a>
            </div>
            `
        } else if (element == '약간 붐빔') {
            return `
            <div
                class="col-3"
                style="background-color: #fd9f28; color:white; line-height: 1.6rem; border-radius: 4px"
            >
                <a style="font-size: 0.9rem; transform: rotate(0.04deg)">${element}</a>
            </div>
            `
        } else if (element == '보통') {
            return `
            <div
                class="col-3"
                style="background-color: #7db249; color:white; line-height: 1.6rem; border-radius: 4px"
            >
                <a style="font-size: 0.9rem; transform: rotate(0.04deg)">${element}</a>
            </div>
            `
        } else if (element == '여유') {
            return `
            <div
                class="col-3"
                style="background-color: #1960ef; color:white; line-height: 1.6rem; border-radius: 4px"
            >
                <a style="font-size: 0.9rem; transform: rotate(0.04deg)">${element}</a>
            </div>
            `
        }
    }
</script>
</html>
