<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Likelist</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
            crossorigin="anonymous"
    />
    <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
            crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* 스크롤 가능한 컨테이너 스타일 */
        .scrollable-container {
            max-height: 680px; /* 원하는 높이로 설정 */
            overflow: auto;
            border: 0px;
            padding: 10px; /* 내용과 테두리 간의 간격 (선택 사항) */
        }
        .copy {
            display: flex;
            align-items: center;
        }
        .copy-button {
            cursor: pointer;
            margin-left: 10px; /* 복사 버튼과 글 사이의 간격 조절 */
        }
    </style>
</head>
<body>
<div class="container mt-3">
    <div class="text-center mb-3">
        <h2 style="font-weight: bold;">찜 목록</h2>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" style="margin-left: 10px; margin-right: 10px;" type="checkbox" value="" id="flexCheckDefault">
        <label class="form-check-label fw-bold" for="flexCheckDefault">
            양호만 표시
        </label>
    </div>
    <div class="text-left mb-1" style="margin-left: 33px;">
<!--        <button type="button" class="btn btn-secondary fw-bold" style="background-color: coral; border: none">거리순</button>-->
    </div>
</div>
<div class="scrollable-container mt-2" id="cardInnerHTML">

</div>

<div id="menuBar"></div>
<script src="/js/menuBar.js"></script>
</body>
<script>
    const cardInnerHTML = document.getElementById('cardInnerHTML');
    var temp = [];
    sendData();
    async function sendData() {
        const resp = await fetch('/getLikeAll', {
            method: 'post'
        })
        const result = await resp.json();
        temp = result
        render(result)
    }
    function render(result) {
        cardInnerHTML.innerHTML = '';
        result.forEach(item => {
            cardInnerHTML.innerHTML += `
                <div class="card mb-4">
                    <div class="card-header">
                        <span>
                            <div class="row fw-bold">
                                <div class="col-7">
                                    <a href="#" style="font-size: 0.9rem; margin-left: 0.4rem">${item.storeName}</a>
                                </div>
                                <div
                                    class="col-3"
                                    style="background-color: orange; line-height: 1.6rem; border-radius: 4px"
                                >
                                    <a style="font-size: 0.9rem">약간 붐빔</a>
                                </div>
                                <div class="col-1">
                                    <a href="#" id="like-button" data-name="${item.storeName}" data-store="${item.storeNewAddr}" onclick="undo(this)">
                                        <img src="/img/star-fill.svg" alt="star">
                                    </a>
                                </div>
                            </div>
                        </span>
                    </div>
                </div>
                `
        })

    }
    // 버튼 클릭 시 부모 div 삭제하는 함수
    function removeCard() {
        var card = this.closest('.card');
        card.remove();
    }

    // 모든 like-button 요소에 클릭 이벤트 추가
    var likeButtons = document.querySelectorAll('#like-button');
    likeButtons.forEach(function(button) {
        button.addEventListener('click', removeCard);
    });


    async function undo(element) {
        const storeName = element.dataset.name;
        const storeNewAddr = element.dataset.store;
        console.log(storeName, storeNewAddr);
        await fetch ('/like', {
            method: 'post',
            headers: {
                'Content-Type' : 'application/json'
            },
            body: JSON.stringify({
                storeName: storeName,
                storeNewAddr: storeNewAddr
            })
        })
        const itemFind = temp.find((item)=> {
            return item.storeName === storeName;
        })
        const idx = temp.indexOf(itemFind);
        if (idx > -1) {
            temp.splice(idx, 1);
        }
        render(temp)
    }
</script>
</html>